import{g as L,l as T}from"./index-K3Qf8Kom.js";const x=n=>(n||"").toLowerCase().replace(/[^\p{L}\p{N}\s]/gu," ").replace(/\s+/g," ").trim().split(" ").filter(Boolean),A=n=>(n||"").split(new RegExp("(?<=[.!?。？！])\\s+|[\\n\\r]+","g")).map(s=>s.trim()).filter(Boolean);async function M(n,s){const f=L();if(!f||!f.docs?.length)return[];let I=s,m=s;try{let e="ko";if(n.detector?.detect){const t=await n.detector.detect(s.slice(0,2e3));e=(Array.isArray(t)?t[0]:t)?.detectedLanguage||"ko"}if(e!=="en"){const t=await n.getTranslator(e,"en");t&&(m=await t.translate(s))}}catch{}const d=Array.from(new Set([...x(I),...x(m)])).filter(Boolean);if(console.log("[docSearch] query tokens:",d),!d.length)return[];const{vocab:S,docs:u,k:w,b:k,avgdl:y}=f,g=new Map;for(const e of d){const t=S[e];if(t)for(const o of t.postings){const c=u[o.docId];if(!c)continue;const r=o.tf,l=t.idf||1,i=r+w*(1-k+k*(c.len/Math.max(1,y))),a=l*(r*(w+1)/Math.max(1e-9,i));g.set(o.docId,(g.get(o.docId)??0)+a)}}const p=[...g.entries()].sort((e,t)=>t[1]-e[1]).slice(0,5);if(console.log("[docSearch] raw scores:",p),!p.length)return[];const h=[];for(const[e,t]of p){const o=u[e],c=T().find(a=>a.id===o.id)||o,r=c.body||c.koText||c.enText||"",l=A(r),i=l.find(a=>d.some(b=>a.toLowerCase().includes(b)))??l[0]??r.slice(0,220);h.push({articleId:o.id,title:o.title||"(제목 없음)",score:t,snippet:i.length>300?i.slice(0,297)+"…":i})}return console.log("[docSearch] hits:",h),h}export{M as searchDocs};
